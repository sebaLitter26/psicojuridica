"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[272],{9272:(Vt,se,f)=>{f.r(se),f.d(se,{ChatRoutes:()=>Nt});var q={};f.r(q),f.d(q,{Decoder:()=>ee,Encoder:()=>vt,PacketType:()=>h,protocol:()=>Re});var U={};f.r(U),f.d(U,{Manager:()=>P,Socket:()=>te,connect:()=>C,default:()=>C,io:()=>C,protocol:()=>Re});var ne=f(467),ie=f(5312),o=f(3953),re=f(1413),Ne=f(1985),oe=f(8750),ce=f(7707),Me=f(9974);function F(n,t,...e){if(!0===t)return void n();if(!1===t)return;const s=new ce.Ms({next:()=>{s.unsubscribe(),n()}});return(0,oe.Tg)(t(...e)).subscribe(s)}const b=Object.create(null);b.open="0",b.close="1",b.ping="2",b.pong="3",b.message="4",b.upgrade="5",b.noop="6";const O=Object.create(null);Object.keys(b).forEach(n=>{O[b[n]]=n});const j={type:"error",data:"parser error"},ae="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),he="function"==typeof ArrayBuffer,le=n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,H=({type:n,data:t},e,s)=>ae&&t instanceof Blob?e?s(t):ue(t,s):he&&(t instanceof ArrayBuffer||le(t))?e?s(t):ue(new Blob([t]),s):s(b[n]+(t||"")),ue=(n,t)=>{const e=new FileReader;return e.onload=function(){const s=e.result.split(",")[1];t("b"+(s||""))},e.readAsDataURL(n)};function fe(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let K;const _=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<64;n++)_["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(n)]=n;const De="function"==typeof ArrayBuffer,$=(n,t)=>{if("string"!=typeof n)return{type:"message",data:de(n,t)};const e=n.charAt(0);return"b"===e?{type:"message",data:qe(n.substring(1),t)}:O[e]?n.length>1?{type:O[e],data:n.substring(1)}:{type:O[e]}:j},qe=(n,t)=>{if(De){const e=(n=>{let s,r,c,a,l,t=.75*n.length,e=n.length,i=0;"="===n[n.length-1]&&(t--,"="===n[n.length-2]&&t--);const p=new ArrayBuffer(t),d=new Uint8Array(p);for(s=0;s<e;s+=4)r=_[n.charCodeAt(s)],c=_[n.charCodeAt(s+1)],a=_[n.charCodeAt(s+2)],l=_[n.charCodeAt(s+3)],d[i++]=r<<2|c>>4,d[i++]=(15&c)<<4|a>>2,d[i++]=(3&a)<<6|63&l;return p})(n);return de(e,t)}return{base64:!0,data:n}},de=(n,t)=>"blob"===t?n instanceof Blob?n:new Blob([n]):n instanceof ArrayBuffer?n:n.buffer;let W;function R(n){return n.reduce((t,e)=>t+e.length,0)}function B(n,t){if(n[0].length===t)return n.shift();const e=new Uint8Array(t);let s=0;for(let i=0;i<t;i++)e[i]=n[0][s++],s===n[0].length&&(n.shift(),s=0);return n.length&&s<n[0].length&&(n[0]=n[0].slice(s)),e}function u(n){if(n)return function Ke(n){for(var t in u.prototype)n[t]=u.prototype[t];return n}(n)}u.prototype.on=u.prototype.addEventListener=function(n,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(t),this},u.prototype.once=function(n,t){function e(){this.off(n,e),t.apply(this,arguments)}return e.fn=t,this.on(n,e),this},u.prototype.off=u.prototype.removeListener=u.prototype.removeAllListeners=u.prototype.removeEventListener=function(n,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e=this._callbacks["$"+n];if(!e)return this;if(1==arguments.length)return delete this._callbacks["$"+n],this;for(var s,i=0;i<e.length;i++)if((s=e[i])===t||s.fn===t){e.splice(i,1);break}return 0===e.length&&delete this._callbacks["$"+n],this},u.prototype.emitReserved=u.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+n],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(e){s=0;for(var i=(e=e.slice(0)).length;s<i;++s)e[s].apply(this,t)}return this},u.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},u.prototype.hasListeners=function(n){return!!this.listeners(n).length};const g=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function ye(n,...t){return t.reduce((e,s)=>(n.hasOwnProperty(s)&&(e[s]=n[s]),e),{})}const $e=g.setTimeout,We=g.clearTimeout;function x(n,t){t.useNativeTimers?(n.setTimeoutFn=$e.bind(g),n.clearTimeoutFn=We.bind(g)):(n.setTimeoutFn=g.setTimeout.bind(g),n.clearTimeoutFn=g.clearTimeout.bind(g))}function Ge(n){return"string"==typeof n?function ze(n){let t=0,e=0;for(let s=0,i=n.length;s<i;s++)t=n.charCodeAt(s),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(s++,e+=4);return e}(n):Math.ceil(1.33*(n.byteLength||n.size))}class Qe extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class Y extends u{constructor(t){super(),this.writable=!1,x(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,s){return super.emitReserved("error",new Qe(t,e,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=$(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return-1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){const e=function Je(n){let t="";for(let e in n)n.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(n[e]));return t}(t);return e.length?"?"+e:""}}const me="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),L=64,be={};let we,ve=0,w=0;function Ce(n){let t="";do{t=me[n%L]+t,n=Math.floor(n/L)}while(n>0);return t}function ke(){const n=Ce(+new Date);return n!==we?(ve=0,we=n):n+"."+Ce(ve++)}for(;w<L;w++)be[me[w]]=w;let Ee=!1;try{Ee=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Ze=Ee;function Se(n){const t=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Ze))return new XMLHttpRequest}catch{}if(!t)try{return new(g[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function et(){}const tt=null!=new Se({xdomain:!1}).responseType;let N=(()=>{class n extends u{constructor(e,s){super(),x(this,s),this.opts=s,this.method=s.method||"GET",this.uri=e,this.data=void 0!==s.data?s.data:null,this.create()}create(){var e;const s=ye(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this.opts.xd;const i=this.xhr=new Se(s);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{var r;3===i.readyState&&(null===(r=this.opts.cookieJar)||void 0===r||r.parseCookies(i)),4===i.readyState&&(200===i.status||1223===i.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof i.status?i.status:0)},0))},i.send(this.data)}catch(r){return void this.setTimeoutFn(()=>{this.onError(r)},0)}typeof document<"u"&&(this.index=n.requestsCount++,n.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=et,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete n.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return n.requestsCount=0,n.requests={},n})();function _e(){for(let n in N.requests)N.requests.hasOwnProperty(n)&&N.requests[n].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",_e):"function"==typeof addEventListener&&addEventListener("onpagehide"in g?"pagehide":"unload",_e,!1));const G="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),M=g.WebSocket||g.MozWebSocket,Ae=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),ot={websocket:class it extends Y{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,s=Ae?{}:ye(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=Ae?new M(t,e,s):e?new M(t,e):new M(t)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const i=e===t.length-1;H(t[e],this.supportsBinary,r=>{try{this.ws.send(r)}catch{}i&&G(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=ke()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}check(){return!!M}},webtransport:class rt extends Y{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(t=>{const e=function He(n,t){W||(W=new TextDecoder);const e=[];let s=0,i=-1,r=!1;return new TransformStream({transform(c,a){for(e.push(c);;){if(0===s){if(R(e)<1)break;const l=B(e,1);r=!(128&~l[0]),i=127&l[0],s=i<126?3:126===i?1:2}else if(1===s){if(R(e)<2)break;const l=B(e,2);i=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),s=3}else if(2===s){if(R(e)<8)break;const l=B(e,8),p=new DataView(l.buffer,l.byteOffset,l.length),d=p.getUint32(0);if(d>Math.pow(2,21)-1){a.enqueue(j);break}i=d*Math.pow(2,32)+p.getUint32(4),s=3}else{if(R(e)<i)break;const l=B(e,i);a.enqueue($(r?l:W.decode(l),t)),s=0}if(0===i||i>n){a.enqueue(j);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(e).getReader(),i=function je(){return new TransformStream({transform(n,t){!function Pe(n,t){ae&&n.data instanceof Blob?n.data.arrayBuffer().then(fe).then(t):he&&(n.data instanceof ArrayBuffer||le(n.data))?t(fe(n.data)):H(n,!1,e=>{K||(K=new TextEncoder),t(K.encode(e))})}(n,e=>{const s=e.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const r=new DataView(i.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{i=new Uint8Array(9);const r=new DataView(i.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}n.data&&"string"!=typeof n.data&&(i[0]|=128),t.enqueue(i),t.enqueue(e)})}})}();i.readable.pipeTo(t.writable),this.writer=i.writable.getWriter();const r=()=>{s.read().then(({done:a,value:l})=>{a||(this.onPacket(l),r())}).catch(a=>{})};r();const c={type:"open"};this.query.sid&&(c.data=`{"sid":"${this.query.sid}"}`),this.writer.write(c).then(()=>this.onOpen())})}))}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const i=e===t.length-1;this.writer.write(t[e]).then(()=>{i&&G(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;null===(t=this.transport)||void 0===t||t.close()}},polling:class st extends Y{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const s="https:"===location.protocol;let i=location.port;i||(i=s?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port}this.supportsBinary=tt&&!(t&&t.forceBase64),this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let s=0;this.polling&&(s++,this.once("pollComplete",function(){--s||e()})),this.writable||(s++,this.once("drain",function(){--s||e()}))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((n,t)=>{const e=n.split("\x1e"),s=[];for(let i=0;i<e.length;i++){const r=$(e[i],t);if(s.push(r),"error"===r.type)break}return s})(t,this.socket.binaryType).forEach(s=>{if("opening"===this.readyState&&"open"===s.type&&this.onOpen(),"close"===s.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((n,t)=>{const e=n.length,s=new Array(e);let i=0;n.forEach((r,c)=>{H(r,!1,a=>{s[c]=a,++i===e&&t(s.join("\x1e"))})})})(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=ke()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(t,e)}request(t={}){return Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new N(this.uri(),t)}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",(i,r)=>{this.onError("xhr post error",i,r)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(e,s)=>{this.onError("xhr poll error",e,s)}),this.pollXhr=t}}},ct=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,at=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function J(n){if(n.length>2e3)throw"URI too long";const t=n,e=n.indexOf("["),s=n.indexOf("]");-1!=e&&-1!=s&&(n=n.substring(0,e)+n.substring(e,s).replace(/:/g,";")+n.substring(s,n.length));let i=ct.exec(n||""),r={},c=14;for(;c--;)r[at[c]]=i[c]||"";return-1!=e&&-1!=s&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function ht(n,t){const s=t.replace(/\/{2,9}/g,"/").split("/");return("/"==t.slice(0,1)||0===t.length)&&s.splice(0,1),"/"==t.slice(-1)&&s.splice(s.length-1,1),s}(0,r.path),r.queryKey=function lt(n,t){const e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,r){i&&(e[i]=r)}),e}(0,r.query),r}let Te=(()=>{class n extends u{constructor(e,s={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],e&&"object"==typeof e&&(s=e,e=null),e?(e=J(e),s.hostname=e.host,s.secure="https"===e.protocol||"wss"===e.protocol,s.port=e.port,e.query&&(s.query=e.query)):s.host&&(s.hostname=J(s.host).host),x(this,s),this.secure=null!=s.secure?s.secure:typeof location<"u"&&"https:"===location.protocol,s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=s.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function Xe(n){let t={},e=n.split("&");for(let s=0,i=e.length;s<i;s++){let r=e[s].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const s=Object.assign({},this.opts.query);s.EIO=4,s.transport=e,this.id&&(s.sid=this.id);const i=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new ot[e](i)}open(){let e;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch{return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",s=>this.onClose("transport close",s))}probe(e){let s=this.createTransport(e),i=!1;n.priorWebsocketSuccess=!1;const r=()=>{i||(s.send([{type:"ping",data:"probe"}]),s.once("packet",m=>{if(!i)if("pong"===m.type&&"probe"===m.data){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;n.priorWebsocketSuccess="websocket"===s.name,this.transport.pause(()=>{i||"closed"!==this.readyState&&(k(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const v=new Error("probe error");v.transport=s.name,this.emitReserved("upgradeError",v)}}))};function c(){i||(i=!0,k(),s.close(),s=null)}const a=m=>{const v=new Error("probe error: "+m);v.transport=s.name,c(),this.emitReserved("upgradeError",v)};function l(){a("transport closed")}function p(){a("socket closed")}function d(m){s&&m.name!==s.name&&c()}const k=()=>{s.removeListener("open",r),s.removeListener("error",a),s.removeListener("close",l),this.off("close",p),this.off("upgrading",d)};s.once("open",r),s.once("error",a),s.once("close",l),this.once("close",p),this.once("upgrading",d),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{i||s.open()},200):s.open()}onOpen(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const s=this.upgrades.length;for(;e<s;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const s=new Error("server error");s.code=e.data,this.onError(s);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let i=0;i<this.writeBuffer.length;i++){const r=this.writeBuffer[i].data;if(r&&(s+=Ge(r)),i>0&&s>this.maxPayload)return this.writeBuffer.slice(0,i);s+=2}return this.writeBuffer}write(e,s,i){return this.sendPacket("message",e,s,i),this}send(e,s,i){return this.sendPacket("message",e,s,i),this}sendPacket(e,s,i,r){if("function"==typeof s&&(r=s,s=void 0),"function"==typeof i&&(r=i,i=null),"closing"===this.readyState||"closed"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;const c={type:e,data:s,options:i};this.emitReserved("packetCreate",c),this.writeBuffer.push(c),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),e()},i=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}onError(e){n.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,s){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,s),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const s=[];let i=0;const r=e.length;for(;i<r;i++)~this.transports.indexOf(e[i])&&s.push(e[i]);return s}}return n.protocol=4,n})();const ft="function"==typeof ArrayBuffer,dt=n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Oe=Object.prototype.toString,pt="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Oe.call(Blob),gt="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===Oe.call(File);function X(n){return ft&&(n instanceof ArrayBuffer||dt(n))||pt&&n instanceof Blob||gt&&n instanceof File}function V(n,t){if(!n||"object"!=typeof n)return!1;if(Array.isArray(n)){for(let e=0,s=n.length;e<s;e++)if(V(n[e]))return!0;return!1}if(X(n))return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return V(n.toJSON(),!0);for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&V(n[e]))return!0;return!1}function yt(n){const t=[],s=n;return s.data=Q(n.data,t),s.attachments=t.length,{packet:s,buffers:t}}function Q(n,t){if(!n)return n;if(X(n)){const e={_placeholder:!0,num:t.length};return t.push(n),e}if(Array.isArray(n)){const e=new Array(n.length);for(let s=0;s<n.length;s++)e[s]=Q(n[s],t);return e}if("object"==typeof n&&!(n instanceof Date)){const e={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=Q(n[s],t));return e}return n}function mt(n,t){return n.data=Z(n.data,t),delete n.attachments,n}function Z(n,t){if(!n)return n;if(n&&!0===n._placeholder){if("number"==typeof n.num&&n.num>=0&&n.num<t.length)return t[n.num];throw new Error("illegal attachments")}if(Array.isArray(n))for(let e=0;e<n.length;e++)n[e]=Z(n[e],t);else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&(n[e]=Z(n[e],t));return n}const bt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Re=5;var h=function(n){return n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK",n}(h||{});class vt{constructor(t){this.replacer=t}encode(t){return t.type!==h.EVENT&&t.type!==h.ACK||!V(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===h.EVENT?h.BINARY_EVENT:h.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return(t.type===h.BINARY_EVENT||t.type===h.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=yt(t),s=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(s),i}}function Be(n){return"[object Object]"===Object.prototype.toString.call(n)}class ee extends u{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const s=e.type===h.BINARY_EVENT;s||e.type===h.BINARY_ACK?(e.type=s?h.EVENT:h.ACK,this.reconstructor=new wt(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!X(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(void 0===h[s.type])throw new Error("unknown packet type "+s.type);if(s.type===h.BINARY_EVENT||s.type===h.BINARY_ACK){const r=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const c=t.substring(r,e);if(c!=Number(c)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(c)}if("/"===t.charAt(e+1)){const r=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);s.nsp=t.substring(r,e)}else s.nsp="/";const i=t.charAt(e+1);if(""!==i&&Number(i)==i){const r=e+1;for(;++e;){const c=t.charAt(e);if(null==c||Number(c)!=c){--e;break}if(e===t.length)break}s.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(!ee.isPayloadValid(s.type,r))throw new Error("invalid payload");s.data=r}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case h.CONNECT:return Be(e);case h.DISCONNECT:return void 0===e;case h.CONNECT_ERROR:return"string"==typeof e||Be(e);case h.EVENT:case h.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===bt.indexOf(e[0]));case h.ACK:case h.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class wt{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const e=mt(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function y(n,t,e){return n.on(t,e),function(){n.off(t,e)}}const Ct=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class te extends u{constructor(t,e,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[y(t,"open",this.onopen.bind(this)),y(t,"packet",this.onpacket.bind(this)),y(t,"error",this.onerror.bind(this)),y(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(Ct.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const s={type:h.EVENT,data:e,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const c=this.ids++,a=e.pop();this._registerAckCallback(c,a),s.id=c}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,e){var s;const i=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===i)return void(this.acks[t]=e);const r=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===t&&this.sendBuffer.splice(a,1);e.call(this,new Error("operation has timed out"))},i),c=(...a)=>{this.io.clearTimeoutFn(r),e.apply(this,a)};c.withError=!0,this.acks[t]=c}emitWithAck(t,...e){return new Promise((s,i)=>{const r=(c,a)=>c?i(c):s(a);r.withError=!0,e.push(r),this.emit(t,...e)})}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...r)=>s!==this._queue[0]?void 0:(null!==i?s.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(i)):(this._queue.shift(),e&&e(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:h.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case h.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case h.EVENT:case h.BINARY_EVENT:this.onevent(t);break;case h.ACK:case h.BINARY_ACK:this.onack(t);break;case h.DISCONNECT:this.ondisconnect();break;case h.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let s=!1;return function(...i){s||(s=!0,e.packet({type:h.ACK,id:t,data:i}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:h.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e)s.apply(this,t.data)}}}function S(n){this.ms=(n=n||{}).min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}S.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*n);n=1&Math.floor(10*t)?n+e:n-e}return 0|Math.min(n,this.max)},S.prototype.reset=function(){this.attempts=0},S.prototype.setMin=function(n){this.ms=n},S.prototype.setMax=function(n){this.max=n},S.prototype.setJitter=function(n){this.jitter=n};class P extends u{constructor(t,e){var s;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,x(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=e.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new S({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const i=e.parser||q;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Te(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=y(e,"open",function(){s.onopen(),t&&t()}),r=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),t?t(a):this.maybeReconnectOnOpen()},c=y(e,"error",r);if(!1!==this._timeout){const l=this.setTimeoutFn(()=>{i(),r(new Error("timeout")),e.close()},this._timeout);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(c),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(y(t,"ping",this.onping.bind(this)),y(t,"data",this.ondata.bind(this)),y(t,"error",this.onerror.bind(this)),y(t,"close",this.onclose.bind(this)),y(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){G(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new te(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const s of e)if(this.nsps[s].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},e);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const A={};function C(n,t){"object"==typeof n&&(t=n,n=void 0);const e=function ut(n,t="",e){let s=n;e=e||typeof location<"u"&&location,null==n&&(n=e.protocol+"//"+e.host),"string"==typeof n&&("/"===n.charAt(0)&&(n="/"===n.charAt(1)?e.protocol+n:e.host+n),/^(https?|wss?):\/\//.test(n)||(n=typeof e<"u"?e.protocol+"//"+n:"https://"+n),s=J(n)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+t,s.href=s.protocol+"://"+r+(e&&e.port===s.port?"":":"+s.port),s}(n,(t=t||{}).path||"/socket.io"),s=e.source,i=e.id;let l;return t.forceNew||t["force new connection"]||!1===t.multiplex||A[i]&&e.path in A[i].nsps?l=new P(s,t):(A[i]||(A[i]=new P(s,t)),l=A[i]),e.query&&!t.query&&(t.query=e.queryKey),l.socket(e.path,t)}Object.assign(C,{Manager:P,Socket:te,io:C,connect:C});class xe{config;subscribersCounter={};eventObservables$={};ioSocket;emptyConfig={url:"",options:{}};constructor(t){this.config=t,void 0===t&&(t=this.emptyConfig),this.ioSocket=(C||U)(t.url,t.options)}of(t){this.ioSocket.of(t)}on(t,e){this.ioSocket.on(t,e)}once(t,e){this.ioSocket.once(t,e)}connect(t){return this.ioSocket.connect(t)}disconnect(t){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(t,...e){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(t,e){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(t){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(t){return this.subscribersCounter[t]||(this.subscribersCounter[t]=0),this.subscribersCounter[t]++,this.eventObservables$[t]||(this.eventObservables$[t]=new Ne.c(e=>{const s=i=>{e.next(i)};return this.ioSocket.on(t,s),()=>{this.subscribersCounter[t]--,0===this.subscribersCounter[t]&&(this.ioSocket.removeListener(t,s),delete this.eventObservables$[t])}}).pipe(function Ve(n={}){const{connector:t=(()=>new re.B),resetOnError:e=!0,resetOnComplete:s=!0,resetOnRefCountZero:i=!0}=n;return r=>{let c,a,l,p=0,d=!1,k=!1;const m=()=>{a?.unsubscribe(),a=void 0},v=()=>{m(),c=l=void 0,d=k=!1},Mt=()=>{const T=c;v(),T?.unsubscribe()};return(0,Me.N)((T,Le)=>{p++,!k&&!d&&m();const I=l=l??t();Le.add(()=>{p--,0===p&&!k&&!d&&(a=F(Mt,i))}),I.subscribe(Le),!c&&p>0&&(c=new ce.Ms({next:D=>I.next(D),error:D=>{k=!0,m(),a=F(v,e,D),I.error(D)},complete:()=>{d=!0,m(),a=F(v,s),I.complete()}}),(0,oe.Tg)(T).subscribe(c))})(r)}}())),this.eventObservables$[t]}fromOneTimeEvent(t){return new Promise(e=>this.once(t,e))}listeners(t){return this.ioSocket.listeners(t)}listenersAny(){return this.ioSocket.listenersAny()}listenersAnyOutgoing(){return this.ioSocket.listenersAnyOutgoing()}off(t,e){return t?t&&!e?this.ioSocket.off(t):this.ioSocket.off(t,e):this.ioSocket.offAny()}onAny(t){return this.ioSocket.onAny(t)}onAnyOutgoing(t){return this.ioSocket.onAnyOutgoing(t)}prependAny(t){return this.ioSocket.prependAny(t)}prependAnyOutgoing(t){return this.ioSocket.prependAnyOutgoing(t)}timeout(t){return this.ioSocket.timeout(t)}volatile(){return this.ioSocket.volatile}}new o.nKC("__SOCKET_IO_CONFIG__");const kt=ie.c.wsEndpoint;let Et=(()=>{class n{constructor(){this.messagesSubject=new re.B,this.messages$=this.messagesSubject.asObservable()}connect(){(!this.webSocket||this.webSocket)&&(this.webSocket=new xe({url:kt,options:{transports:["websocket"]}}),this.webSocket.fromEvent("offer").subscribe(e=>{console.log("offer",e.type),this.messagesSubject.next(e)}),this.webSocket.fromEvent("ice-candidate").subscribe(e=>{console.log("ice-candidate",e),this.messagesSubject.next(e)}),this.webSocket.fromEvent("answer").subscribe(e=>{console.log("answer",e),this.messagesSubject.next(e)}),this.webSocket.fromEvent("hangup").subscribe(e=>{console.log("hangup",e),this.messagesSubject.next(e)}))}sendMessage(e){console.log("sending message: "+e.type),this.webSocket.emit(e.type,e)}disconnectSocket(){this.webSocket.disconnect()}static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275prov=o.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const St=["local_video"],_t=["received_video"];function At(n,t){1&n&&(o.qSk(),o.j41(0,"svg",6),o.nrm(1,"path",13),o.k0s())}function Tt(n,t){1&n&&(o.qSk(),o.j41(0,"svg",6),o.nrm(1,"path",14),o.k0s())}function Ot(n,t){1&n&&(o.qSk(),o.j41(0,"svg",6),o.nrm(1,"path",15),o.k0s())}function Rt(n,t){1&n&&(o.qSk(),o.j41(0,"svg",7),o.nrm(1,"path",16),o.k0s())}const Bt=ie.c.RTCPeerConfiguration,xt={audio:!0,video:{width:1280,height:720}},Lt={offerToReceiveAudio:!0,offerToReceiveVideo:!0},Nt=[{path:"",component:(()=>{class n{constructor(e){this.dataService=e,this.inCall=!1,this.localVideoActive=!0,this.localAudioActive=!1,this.reportError=s=>{console.log("got Error: "+s.name),console.log(s)},this.handleICECandidateEvent=s=>{s.candidate&&this.dataService.sendMessage({type:"ice-candidate",data:s.candidate})},this.handleICEConnectionStateChangeEvent=s=>{switch(console.log(s),this.peerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this.closeVideoCall()}},this.handleSignalingStateChangeEvent=s=>{"closed"===(console.log(s),this.peerConnection.signalingState)&&this.closeVideoCall()},this.handleTrackEvent=s=>{console.log(s),this.remoteVideo.nativeElement.srcObject=s.streams[0]}}call(){var e=this;return(0,ne.A)(function*(){e.createPeerConnection(),e.localStream.getTracks().forEach(s=>e.peerConnection.addTrack(s,e.localStream));try{const s=yield e.peerConnection.createOffer(Lt);yield e.peerConnection.setLocalDescription(s),e.inCall=!0,e.dataService.sendMessage({type:"offer",data:s})}catch(s){e.handleGetUserMediaError(s)}})()}hangUp(){this.dataService.sendMessage({type:"hangup",data:""}),this.closeVideoCall()}ngAfterViewInit(){this.addIncominMessageHandler(),this.requestMediaDevices()}addIncominMessageHandler(){this.dataService.connect(),this.dataService.messages$.subscribe({next:e=>{switch(console.log("Received message: ",e),e.type){case"offer":this.handleOfferMessage(e.data);break;case"answer":this.handleAnswerMessage(e.data);break;case"hangup":this.handleHangupMessage(e);break;case"ice-candidate":this.handleICECandidateMessage(e.data);break;default:console.log("unknown message of type "+e.type)}},error:e=>console.log(e)})}handleOfferMessage(e){console.log("handle incoming offer"),this.peerConnection||this.createPeerConnection(),this.localStream||this.switchLocalVideo(),console.log("msg",e),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)).then(()=>{this.localVideo.nativeElement.srcObject=this.localStream,this.localStream.getTracks().forEach(s=>this.peerConnection.addTrack(s,this.localStream))}).then(()=>this.peerConnection.createAnswer()).then(s=>this.peerConnection.setLocalDescription(s)).then(()=>{this.dataService.sendMessage({type:"answer",data:this.peerConnection.localDescription}),this.inCall=!0}).catch(this.handleGetUserMediaError)}handleAnswerMessage(e){console.log("handle incoming answer"),this.peerConnection.setRemoteDescription(e)}handleHangupMessage(e){console.log(e),this.closeVideoCall()}handleICECandidateMessage(e){const s=new RTCIceCandidate(e);console.log(s,e),this.peerConnection.addIceCandidate(s).catch(this.reportError)}requestMediaDevices(){var e=this;return(0,ne.A)(function*(){try{e.localStream=yield navigator.mediaDevices.getUserMedia(xt),e.startLocalVideo()}catch(s){console.error(s),alert(`Cannot access remote users. Server lost. error: ${s.name}`)}})()}startLocalVideo(){console.log("starting local stream"),this.localStream.getTracks().forEach(e=>{e.enabled=!0}),this.localVideo.nativeElement.srcObject=this.localStream,this.localVideoActive=!0,this.localAudioActive=!0}switchLocalVideo(){console.log("pause local video stream"),this.localStream.getTracks().forEach(e=>{"video"===e.kind&&(console.log(e.kind),e.enabled=!e.enabled,this.localVideoActive=!this.localVideoActive)})}switchLocalAudio(){console.log("pause local audio stream"),this.localStream.getTracks().forEach(e=>{"audio"===e.kind&&(e.enabled=!e.enabled,this.localAudioActive=!this.localAudioActive)})}createPeerConnection(){console.log("creating PeerConnection..."),this.peerConnection=new RTCPeerConnection(Bt),this.peerConnection.onicecandidate=this.handleICECandidateEvent,this.peerConnection.oniceconnectionstatechange=this.handleICEConnectionStateChangeEvent,this.peerConnection.onsignalingstatechange=this.handleSignalingStateChangeEvent,this.peerConnection.ontrack=this.handleTrackEvent}closeVideoCall(){console.log("Closing call"),this.peerConnection&&(console.log("--\x3e Closing the peer connection"),this.peerConnection.ontrack=null,this.peerConnection.onicecandidate=null,this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.getTransceivers().forEach(e=>{e.stop()}),this.peerConnection.close(),this.peerConnection=null,this.inCall=!1)}handleGetUserMediaError(e){switch(console.log(e),e.name){case"NotFoundError":alert("Unable to open your call because no camera and/or microphone were found.");break;case"SecurityError":case"PermissionDeniedError":break;default:console.log(e),alert("Error opening your camera and/or microphone: "+e.message)}this.closeVideoCall()}static#e=this.\u0275fac=function(s){return new(s||n)(o.rXU(Et))};static#t=this.\u0275cmp=o.VBU({type:n,selectors:[["app-chat"]],viewQuery:function(s,i){if(1&s&&(o.GBs(St,5),o.GBs(_t,5)),2&s){let r;o.mGM(r=o.lsd())&&(i.localVideo=r.first),o.mGM(r=o.lsd())&&(i.remoteVideo=r.first)}},standalone:!0,features:[o.aNF],decls:23,vars:7,consts:[["local_video",""],["received_video",""],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-2","gap-10","max-w-screen-xs","mx-auto","text-left"],[1,"video-description"],[3,"autoplay","muted"],["mat-raised-button","","color","primary",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-800","dark:text-white"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-800","dark:text-white"],[3,"autoplay"],["mat-raised-button","","color","primary",3,"click","disabled"],["d","M7.978 4a2.553 2.553 0 0 0-1.926.877C4.233 6.7 3.699 8.751 4.153 10.814c.44 1.995 1.778 3.893 3.456 5.572 1.68 1.679 3.577 3.018 5.57 3.459 2.062.456 4.115-.073 5.94-1.885a2.556 2.556 0 0 0 .001-3.861l-1.21-1.21a2.689 2.689 0 0 0-3.802 0l-.617.618a.806.806 0 0 1-1.14 0l-1.854-1.855a.807.807 0 0 1 0-1.14l.618-.62a2.692 2.692 0 0 0 0-3.803l-1.21-1.211A2.555 2.555 0 0 0 7.978 4Z"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","currentColor",1,"w-6","h-6","text-gray-800","dark:text-white"],["d","M5.47542 12.8632C4.44449 11.2623 3.67643 9.54134 3.17124 7.76144C3.01103 7.19699 2.93093 6.91477 2.9297 6.50182C2.92833 6.0436 3.08969 5.42311 3.31412 5.0236C3.51636 4.66357 3.78117 4.39876 4.3108 3.86913L4.46843 3.7115C4.99987 3.18006 5.2656 2.91433 5.55098 2.76999C6.11854 2.48292 6.7888 2.48292 7.35636 2.76999C7.64174 2.91433 7.90747 3.18006 8.43891 3.7115L8.63378 3.90637C8.98338 4.25597 9.15819 4.43078 9.27247 4.60656C9.70347 5.26945 9.70347 6.12403 9.27247 6.78692C9.15819 6.9627 8.98338 7.1375 8.63378 7.4871C8.51947 7.60142 8.46231 7.65857 8.41447 7.72539C8.24446 7.96281 8.18576 8.30707 8.26748 8.58743C8.29048 8.66632 8.32041 8.72867 8.38028 8.85337C8.50111 9.10503 8.62956 9.35395 8.76563 9.59979M11.1817 12.8181L11.2266 12.8632C12.4282 14.0648 13.7869 15.0136 15.2365 15.7096C15.3612 15.7694 15.4235 15.7994 15.5024 15.8224C15.7828 15.9041 16.127 15.8454 16.3644 15.6754C16.4313 15.6275 16.4884 15.5704 16.6027 15.4561C16.9523 15.1064 17.1271 14.9316 17.3029 14.8174C17.9658 14.3864 18.8204 14.3864 19.4833 14.8174C19.6591 14.9316 19.8339 15.1064 20.1835 15.4561L20.3783 15.6509C20.9098 16.1824 21.1755 16.4481 21.3198 16.7335C21.6069 17.301 21.6069 17.9713 21.3198 18.5389C21.1755 18.8242 20.9098 19.09 20.3783 19.6214L20.2207 19.779C19.6911 20.3087 19.4263 20.5735 19.0662 20.7757C18.6667 21.0001 18.0462 21.1615 17.588 21.1601C17.1751 21.1589 16.8928 21.0788 16.3284 20.9186C13.295 20.0576 10.4326 18.4332 8.04466 16.0452L7.99976 16.0001M20.9996 3.00012L2.99961 21.0001","stroke","#fff"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14 6H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1Zm7 11-6-2V9l6-2v10Z"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 8V17.5C3 18.0523 3.44772 18.5 4 18.5H14M3 3L21 21M10 5.5H15C15.5523 5.5 16 5.94772 16 6.5V9M16 9V11M16 9L21 7V17"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9v3a5.006 5.006 0 0 1-5 5h-4a5.006 5.006 0 0 1-5-5V9m7 9v3m-3 0h6M11 3h2a3 3 0 0 1 3 3v5a3 3 0 0 1-3 3h-2a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3Z"],["d","m15.506 14.097.994.995A3.989 3.989 0 0 0 17.975 12V9.011a.996.996 0 0 1 1.992 0v2.99a5.981 5.981 0 0 1-2.054 4.503l1.762 1.762a.996.996 0 1 1-1.408 1.408L4.325 5.733a.996.996 0 0 1 1.408-1.408L7.04 5.632a3.984 3.984 0 0 1 3.964-3.59h1.992c2.2 0 3.983 1.783 3.983 3.983v4.98a3.975 3.975 0 0 1-1.473 3.092ZM4.033 10.008a.996.996 0 1 1 1.992 0V12a3.99 3.99 0 0 0 3.984 3.984H12c.55 0 .996.446.996.996v2.988h1.992a.996.996 0 0 1 0 1.992H9.012a.996.996 0 0 1 0-1.992h1.992v-1.992h-.997a5.981 5.981 0 0 1-5.974-5.974v-1.993Z"]],template:function(s,i){if(1&s){const r=o.RV6();o.j41(0,"div",2)(1,"div")(2,"p",3),o.EFF(3,"local:"),o.k0s(),o.nrm(4,"video",4,0),o.j41(6,"button",5),o.bIt("click",function(){return o.eBV(r),o.Njj(i.switchLocalVideo())}),o.DNE(7,At,2,0,":svg:svg",6)(8,Tt,2,0,":svg:svg",6),o.k0s(),o.j41(9,"button",5),o.bIt("click",function(){return o.eBV(r),o.Njj(i.switchLocalAudio())}),o.DNE(10,Ot,2,0,":svg:svg",6)(11,Rt,2,0,":svg:svg",7),o.k0s()(),o.j41(12,"div")(13,"p",3),o.EFF(14,"remote:"),o.k0s(),o.nrm(15,"video",8,1),o.j41(17,"button",9),o.bIt("click",function(){return o.eBV(r),o.Njj(i.call())}),o.qSk(),o.j41(18,"svg",7),o.nrm(19,"path",10),o.k0s()(),o.joV(),o.j41(20,"button",9),o.bIt("click",function(){return o.eBV(r),o.Njj(i.hangUp())}),o.qSk(),o.j41(21,"svg",11),o.nrm(22,"path",12),o.k0s()()()()}2&s&&(o.R7$(4),o.Y8G("autoplay",!0)("muted",!0),o.R7$(3),o.vxM(i.localVideoActive?7:8),o.R7$(3),o.vxM(i.localAudioActive?10:11),o.R7$(5),o.Y8G("autoplay",!0),o.R7$(2),o.Y8G("disabled",i.inCall||!i.localVideoActive),o.R7$(3),o.Y8G("disabled",!i.inCall))},styles:["video{width:100%;background:gray}p.video-description{position:absolute;top:0;left:10px}button{margin:1em}\n"],encapsulation:2,changeDetection:0})}return n})()}]}}]);